#!/usr/bin/env python
# -*- coding: utf-8 -*-

def comprehensive_fix():
    # 读取已部分修复的文件
    input_file = r'C:\Dev\PythonBox\predict_classification_gold_final_fixed.py'
    output_file = r'C:\Dev\PythonBox\predict_classification_gold_complete_fixed.py'
    
    with open(input_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # 进行更全面的修复，处理剩余的乱码
    replacements = [
        # 修复剩余的机器学习术语
        ('鍐崇瓥锟?', '决策树'),
        ('闅忔満妫鏋', '随机森林'),
        
        # 修复数据相关术语
        ('璁缁冩暟鎹锟?xlsx', '训练数据.xlsx'),
        ('璇诲彜璺寰勪笅璁缁冩暟锟?', '读取路径下训练数据'),
        ('涓嬩竴鏈熼粍閲戜环锟?', '下一期黄金价格'),
        ('涓嬩竴鏈熸椂锟?', '下一期时间'),
        ('鍚勫洜瀛愭暟鎹锛堣緭鍏ュ彉閲忥拷?', '各因子数据（输入变量）'),
        
        # 修复计算相关术语
        ('璁＄畻娑ㄨ穼锟?', '计算涨跌幅'),
        ('瀹氫箟鏍囩惧垝鍒嗗嚱鏁', '定义标签划分函数'),
        ('鏀剁泭锟?%鍒嗕綅鏁颁綔涓轰笅锟?', '收益1%分位数作为下界'),
        ('鏀剁泭锟?9%鍒嗕綅鏁颁綔涓轰笂锟?', '收益99%分位数作为上界'),
        ('鏀剁泭鐜囧尯闂村垝锟?', '收益率区间划分'),
        ('鎵撲笂鍒嗙被鏍囩', '打上分类标签'),
        
        # 修复数据集相关
        ('鑾峰彇鏍囩俱佹敹鐩婄巼鍖洪棿', '获取标签、收益率区间'),
        ('鍙鍚缁忔祹鏁版嵁', '只含经济数据'),
        ('鍙鍚甯傚満鏁版嵁', '只含市场数据'),
        ('棰勬祴闆嗙粨鏉熸湡锟?', '预测集结束期数'),
        ('棰勬祴锟?', '预测值'),
        ('棰勬祴闆嗗綋鏈熶环锟?', '预测集当期价格'),
        ('棰勬祴闆嗕笅鏈熶环锟?', '预测集下期价格'),
        ('璁缁冮泦鏃堕暱k锟?', '训练集时长k数'),
        ('璁缁冩椂闀夸负棰勬祴鏃剁偣鍓嶆帹k锟?', '训练时长为预测时点前推k数'),
        
        # 修复模型相关
        ('浠ヤ俊鎭澧炵泭浣滀负鍒ゆ柇鏉★拷?', '以信息增益作为判断条件'),
        ('棰勬祴锟?', '预测值'),
        ('鍑嗙‘锟?', '准确率'),
        
        # 修复其他术语
        ('缂哄乏姒傜巼鍒嗭拷?', '概率分布'),  # 这是根据上下文推断的
        ('绱绉姒傜巼鍒嗗竷鍑芥暟', '累积概率分布函数'),
        ('璁＄畻绱绉姒傜巼鍒嗗竷', '计算累积概率分布'),
        ('绱绉姒傜巼锟?.5宸︿晶鐨勪綅锟?', '累积概率0.5左侧的位置'),
        ('绱绉姒傜巼锟?.5鍙充晶鐨勪綅锟?', '累积概率0.5右侧的位置'),
        ('鏀剁泭鐜囧尯闂翠腑锟?', '收益率区间中点'),
        ('姹傞勬祴鏀剁泭鐜囦腑浣嶥?', '求预测收益率中位数'),
        ('姹傞勬祴鏀剁泭鐜囧潎锟?', '求预测收益率均值'),
        ('姹傞勬祴浠锋牸鍧囷拷?', '求预测价格均值'),
        
        # 修复百分位数相关
        ('绱绉姒傜巼锟?.05宸︿晶鐨勪綅锟?', '累积概率0.05左侧的位置'),
        ('绱绉姒傜巼锟?.95宸︿晶鐨勪綅锟?', '累积概率0.95左侧的位置'),
        ('绱绉姒傜巼锟?.1宸︿晶鐨勪綅锟?', '累积概率0.1左侧的位置'),
        ('绱绉姒傜巼锟?.9宸︿晶鐨勪綅锟?', '累积概率0.9左侧的位置'),
        ('绱绉姒傜巼锟?.25宸︿晶鐨勪綅锟?', '累积概率0.25左侧的位置'),
        ('绱绉姒傜巼锟?.75宸︿晶鐨勪綅锟?', '累积概率0.75左侧的位置'),
        ('绱绉姒傜巼锟?.16宸︿晶鐨勪綅锟?', '累积概率0.16左侧的位置'),
        ('绱绉姒傜巼锟?.84宸︿晶鐨勪綅锟?', '累积概率0.84左侧的位置'),
        
        # 修复特定百分位数
        ('姹傞勬祴鏀剁泭鐜10%鍒嗕綅锟?', '求预测收益率10%分位数'),
        ('姹傞勬祴鏀剁泭鐜90%鍒嗕綅锟?', '求预测收益率90%分位数'),
        ('姹傞勬祴鏀剁泭鐜25%鍒嗕綅锟?', '求预测收益率25%分位数'),
        ('姹傞勬祴鏀剁泭鐜75%鍒嗕綅锟?', '求预测收益率75%分位数'),
        ('姹傞勬祴鏀剁泭鐜16%鍒嗕綅锟?', '求预测收益率16%分位数'),
        ('姹傞勬祴鏀剁泭鐜84%鍒嗕綅锟?', '求预测收益率84%分位数'),
        ('姹傞勬祴鏀剁泭鐜5%鍒嗕綅锟?', '求预测收益率5%分位数'),
        ('姹傞勬祴鏀剁泭鐜95%鍒嗕綅锟?', '求预测收益率95%分位数'),
        
        # 修复其他统计术语
        ('棰勬祴绯绘暟锛堟ā鍨嬪氶噸绯绘暟锛夐夊彇', '预测系数（模型倚重系数）选取'),
        ('璁＄畻棰勬祴鏀剁泭鐜囧垎甯冪殑鍧囧笺佹柟宸銆佸嘲搴︺佸亸锟?', '计算预测收益率分布的均值、方差、峰度、偏度'),
    ]
    
    # 执行替换
    for old, new in replacements:
        content = content.replace(old, new)
    
    # 保存修复后的文件
    with open(output_file, 'w', encoding='utf-8') as f:
        f.write(content)
    
    print("全面修复中文字符完成")
    print(f"文件已保存到: {output_file}")
    
    # 显示部分内容以验证修复结果
    with open(output_file, 'r', encoding='utf-8') as f:
        sample = f.read(2000)
        print("修复后文件内容预览:")
        print(sample[:1000])

if __name__ == "__main__":
    comprehensive_fix()